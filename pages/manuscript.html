<!DOCTYPE html>
<html lang="nb">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Manuscript</title>
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="/android101/css/syntax.css">
        <link href="/android101/css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link rel="stylesheet" href="/android101/css/main.css">
        <script src="/android101/js/jquery.min.js"></script>
        <script src="/android101/js/bootstrap.min.js"></script>

    </head>
    <body>
      <div class="container-fluid main">
        <div class="row-fluid">
          <div class="span8">
            <h1 class="page-header">Manuscript</h1>
            <h3>Introduction</h3>
In this session we will create an app where the user can search for a Spotify track, and play the found track on a device. Remember to have
an updated version of Android Studio

<h3>Main</h3>
<ol>
	<li>Open Android Studio, create an empty project.</li>
	<li>Explain Activities (<a href="android-app-structure-and-components.html"> App Structure And Components</a>)</li>
	<li>Run Hello World app and explain debugging.</li>
	<li>Explain layouts and layout controls (<a href="common-view-controls.html"> Common View Controls</a>), (<a href="view-layout.html"> View Layout</a>))</li>
	<li>Explain the UI builder</li>
	<li>Create the MainActivity for the Spotify app. MainActivity will display an input text field and a button. </li>
    <li>Create the layout files and controls for the activity.</li>
    <li>Setup search and explain AsyncTasks (<a href="working-in-the-background.html"> Working In the Background).</a>
    	Print a simple text in <code>doInBackground()</code> to illustrate background work</li>
	<li>Add classes for network communication. We use the Apache HTTP client. Skip live coding this part.</li>
	<li>Add Gradle dependencies for JSON parsing and explain why we need this:
		<p><code>compile 'com.fasterxml.jackson.core:jackson-core:2.2.3'</code></p>
   		<p><code>compile 'com.fasterxml.jackson.core:jackson-databind:2.2.3'</code> </p>
	</li>
	<li>Replace content in <code>doInBackground()</code> with search method HTTPClient. Add a log statement which prints the received json.</li>
	<li>Do not add internet permission until app has run and failed. Explain the Android Manifest and the need for permissions</li> 
	<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.INTERNET&quot;</span> <span class="nt">/&gt;</span></code></pre></div>
	<li>Run app again and view the log statement</li>
	<li>Create the ResultActivity. ResultActivity will display a list containing the search results. Add entries to the Android Manifest</li>
    <li>Remove <code>Toast</code> and start the ResultActivity from the <code>onPostExecute()</code>using Intents. Explain that there are several ways to pass
    	objects between activities, for instance Parcelable. For simplicity, we pass the json as a <code>
    	stringExtra</code></li>
    <li> Create the Artist and Track domain objects. Copy these</li>
    <li> Create the Result dto object and explain its connection to the JSON structure returned by the Spotify API. It will hold a list of tracks</li>
    <li>In the ResultActivity, parse the String as the Result dto domain objects using Jacksons ObjectMapper and readValue()</li>
    <li> Explain that a <code>SimpleListAdapter</code> can be used, but for more complex stuff, we want to create our own adapter</code></li>
    <li>Add and explain custom ListAdapters (<a href="list-list-adapters.html"> Lists and List Adapters).</a> Mention reuse of views by checking if view is null</li>
    <li>Populate the ListAdapter fields with properties from the Track domain objects</li>
    <li>Add a click handler for each list element, where clicks will start Spotify and play song. Explain the use of implicit intents. An example
        can be opening Google Maps in Chrome, where the user is presented with options for which app to open maps in.</li>
</ol>


<h3> Result Dto, AsyncTask and SearchService</h3>

Create the <b>Result</b> Dto object, which will contain a list of tracks
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@JsonIgnoreProperties</span><span class="o">(</span><span class="n">ignoreUnknown</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Result</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Track</span><span class="o">&gt;</span> <span class="n">tracks</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Track</span><span class="o">&gt;</span> <span class="nf">getTracks</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">tracks</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTracks</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Track</span><span class="o">&gt;</span> <span class="n">tracks</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tracks</span> <span class="o">=</span> <span class="n">tracks</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

	Create an <b>AsyncTask</b> for performing the web request
	<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">class</span> <span class="nc">SearchAsyncTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">String</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">tracks</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getTracks</span><span class="o">(</span><span class="n">params</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
            <span class="k">return</span> <span class="n">tracks</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPostExecute</span><span class="o">(</span><span class="n">String</span> <span class="n">resultJson</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">ResultActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">&quot;resultJson&quot;</span><span class="o">,</span> <span class="n">resultJson</span><span class="o">);</span>
            <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span></code></pre></div>

<h3> Classes and Services</h3>
<b>HttpClient</b>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HttpClient</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TRACK_SEARCH_URL</span> <span class="o">=</span> <span class="s">&quot;http://ws.spotify.com/search/1/track.json?q=&quot;</span><span class="o">;</span>

    <span class="cm">/*</span>
<span class="cm">        Method which uses the built-in Apache HTTP client</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTracks</span><span class="o">(</span><span class="n">String</span> <span class="n">trackName</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">trackName</span> <span class="o">=</span> <span class="n">trackName</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">,</span> <span class="s">&quot;%20&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">trackSearchQueryWithArg</span> <span class="o">=</span> <span class="n">TRACK_SEARCH_URL</span> <span class="o">+</span> <span class="n">trackName</span><span class="o">;</span>
        <span class="n">DefaultHttpClient</span> <span class="n">defaultHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">DefaultHttpClient</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
        <span class="n">InputStream</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">HttpGet</span> <span class="n">method</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">HttpGet</span><span class="o">(</span><span class="k">new</span> <span class="nf">URI</span><span class="o">(</span><span class="n">trackSearchQueryWithArg</span><span class="o">));</span>
            <span class="n">HttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">defaultHttpClient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nf">InputStreamReader</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">));</span>
            <span class="n">StringBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="o">();</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">line</span><span class="o">;</span> <span class="o">(</span><span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;)</span> <span class="o">{</span>
                <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">finally</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">data</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">reader</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>


<b>Track</b> domain object

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@JsonIgnoreProperties</span><span class="o">(</span><span class="n">ignoreUnknown</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Track</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span> <span class="n">artists</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">href</span><span class="o">;</span>

	<span class="c1">// Jackson needs an empty constructor</span>
	<span class="kd">public</span> <span class="nf">Track</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getHref</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">href</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHref</span><span class="o">(</span><span class="n">String</span> <span class="n">href</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">href</span> <span class="o">=</span> <span class="n">href</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span> <span class="nf">getArtists</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">artists</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setArtists</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Artist</span><span class="o">&gt;</span> <span class="n">artists</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">artists</span> <span class="o">=</span> <span class="n">artists</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<b>Artist</b> domain object
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@JsonIgnoreProperties</span><span class="o">(</span><span class="n">ignoreUnknown</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Artist</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

	<span class="c1">// Jackson needs an empty constructor</span>
	<span class="kd">public</span> <span class="nf">Artist</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>


<h3>ListAdapter</h3>
List adapter for displaying the search results
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TrackAdapter</span> <span class="kd">extends</span> <span class="n">ArrayAdapter</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">TrackAdapter</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resource</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Track</span><span class="o">&gt;</span> <span class="n">tracks</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">resource</span><span class="o">,</span> <span class="n">tracks</span><span class="o">);</span>

		<span class="n">inflater</span> <span class="o">=</span> <span class="o">(</span><span class="n">LayoutInflater</span><span class="o">)</span><span class="n">context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">LAYOUT_INFLATER_SERVICE</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">View</span> <span class="nf">getView</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">View</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="n">convertView</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">result_list_item</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span> <span class="o">:</span> <span class="n">convertView</span><span class="o">;</span>
		<span class="c1">// Get the track information</span>
		<span class="n">Track</span> <span class="n">track</span> <span class="o">=</span> <span class="o">(</span><span class="n">Track</span><span class="o">)</span> <span class="n">getItem</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
		<span class="n">Artist</span> <span class="n">artist</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="na">getArtists</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

		<span class="c1">// Bind UI elements</span>
		<span class="n">TextView</span> <span class="n">songTextView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">song_text</span><span class="o">);</span>
		<span class="n">TextView</span> <span class="n">artistTextView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">artist_text</span><span class="o">);</span>

		<span class="c1">// Update values</span>
		<span class="n">songTextView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
		<span class="n">artistTextView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">artist</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

		<span class="k">return</span> <span class="n">view</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>

<span class="nt">&lt;LinearLayout</span>
<span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
<span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
<span class="na">android:orientation=</span><span class="s">&quot;vertical&quot;</span>
<span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;RelativeLayout</span>
<span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
<span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;TextView</span>
<span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
<span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
<span class="na">android:textAppearance=</span><span class="s">&quot;?android:attr/textAppearanceLarge&quot;</span>
<span class="na">android:text=</span><span class="s">&quot;Midnatt&quot;</span>
<span class="na">android:id=</span><span class="s">&quot;@+id/song_text&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;TextView</span>
<span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
<span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
<span class="na">android:textAppearance=</span><span class="s">&quot;?android:attr/textAppearanceMedium&quot;</span>
<span class="na">android:text=</span><span class="s">&quot;Oslo ess&quot;</span>
<span class="na">android:id=</span><span class="s">&quot;@+id/artist_text&quot;</span>
<span class="na">android:layout_below=</span><span class="s">&quot;@id/song_text&quot;</span>
<span class="nt">/&gt;</span>
<span class="nt">&lt;/RelativeLayout&gt;</span>
<span class="nt">&lt;/LinearLayout&gt;</span></code></pre></div>

<h3> ResultActivity</h3>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ResultActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
    <span class="n">ListView</span> <span class="n">listView</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_result</span><span class="o">);</span>

        <span class="n">listView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ListView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">listView</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// Get the track list from the MainActivity</span>
            <span class="n">Bundle</span> <span class="n">data</span> <span class="o">=</span> <span class="n">getIntent</span><span class="o">().</span><span class="na">getExtras</span><span class="o">();</span>
            <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ObjectMapper</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Track</span><span class="o">&gt;</span> <span class="n">tracks</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">mapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;tracks&quot;</span><span class="o">),</span> <span class="n">Track</span><span class="o">[].</span><span class="na">class</span><span class="o">));</span>

            <span class="n">listView</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="k">new</span> <span class="nf">TrackAdapter</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">result_list_item</span><span class="o">,</span> <span class="n">tracks</span><span class="o">));</span>
            <span class="n">listView</span><span class="o">.</span><span class="na">setOnItemClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">AdapterView</span><span class="o">.</span><span class="na">OnItemClickListener</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onItemClick</span><span class="o">(</span><span class="n">AdapterView</span><span class="o">&lt;?&gt;</span> <span class="n">parent</span><span class="o">,</span> <span class="n">View</span> <span class="n">view</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// Get the clicked track</span>
                    <span class="n">Track</span> <span class="n">track</span> <span class="o">=</span> <span class="o">(</span><span class="n">Track</span><span class="o">)</span> <span class="n">parent</span><span class="o">.</span><span class="na">getItemAtPosition</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
                    <span class="c1">// Start playback in Spotify</span>
                    <span class="n">Intent</span> <span class="n">appPlayBackIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_VIEW</span><span class="o">,</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">track</span><span class="o">.</span><span class="na">getHref</span><span class="o">()));</span>
                    <span class="c1">// Verify that the device has Spotify and can play the track</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">appPlayBackIntent</span><span class="o">.</span><span class="na">resolveActivity</span><span class="o">(</span><span class="n">getPackageManager</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">startActivity</span><span class="o">(</span><span class="n">appPlayBackIntent</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="k">else</span> <span class="o">{</span>
                        <span class="c1">// Open play store so that the user can download Spotify</span>
                        <span class="n">String</span> <span class="n">packageName</span> <span class="o">=</span> <span class="s">&quot;com.spotify.mobile.android.ui&quot;</span><span class="o">;</span>
                        <span class="k">try</span> <span class="o">{</span>
                            <span class="n">startActivity</span><span class="o">(</span><span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_VIEW</span><span class="o">,</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;market://details?id=&quot;</span> <span class="o">+</span> <span class="n">packageName</span><span class="o">)));</span>
                        <span class="o">}</span>
                        <span class="k">catch</span> <span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">content</span><span class="o">.</span><span class="na">ActivityNotFoundException</span> <span class="n">anfe</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">startActivity</span><span class="o">(</span><span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_VIEW</span><span class="o">,</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;http://play.google.com/store/apps/details?id=&quot;</span> <span class="o">+</span> <span class="n">packageName</span><span class="o">)));</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">});</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Do nothing</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">&lt;</span><span class="n">RelativeLayout</span> <span class="nl">xmlns:</span><span class="n">android</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="nl">xmlns:</span><span class="n">tools</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/tools&quot;</span>
    <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
    <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
    <span class="nl">android:</span><span class="n">paddingLeft</span><span class="o">=</span><span class="s">&quot;@dimen/activity_horizontal_margin&quot;</span>
    <span class="nl">android:</span><span class="n">paddingRight</span><span class="o">=</span><span class="s">&quot;@dimen/activity_horizontal_margin&quot;</span>
    <span class="nl">android:</span><span class="n">paddingTop</span><span class="o">=</span><span class="s">&quot;@dimen/activity_vertical_margin&quot;</span>
    <span class="nl">android:</span><span class="n">paddingBottom</span><span class="o">=</span><span class="s">&quot;@dimen/activity_vertical_margin&quot;</span>
    <span class="nl">android:</span><span class="n">background</span><span class="o">=</span><span class="s">&quot;@color/dark_gray&quot;</span>
    <span class="nl">tools:</span><span class="n">context</span><span class="o">=</span><span class="s">&quot;no.bekk.spotifyapieksempel.ResultActivity&quot;</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">ListView</span>
        <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/listView&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">RelativeLayout</span><span class="o">&gt;</span></code></pre></div>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;num_results&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="nt">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;\&quot;godset fra drammen\&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;track&quot;</span><span class="p">,</span>
    <span class="nt">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">},</span>
  <span class="nt">&quot;tracks&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;album&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;released&quot;</span><span class="p">:</span> <span class="s2">&quot;2008&quot;</span><span class="p">,</span>
        <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;spotify:album:7nrjbBpy8yrueDbKCBY6Ef&quot;</span><span class="p">,</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;2 x femogf√∏rr&quot;</span><span class="p">,</span>
        <span class="nt">&quot;availability&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;territories&quot;</span><span class="p">:</span> <span class="s2">&quot;AD AR AT AU BE BG BO BR CA CH CL CO CR CY CZ DE DK DO EC EE ES FI FR GB GR GT HK HN HR HU IE IS IT LI LT LU LV MC MT MX MY NI NL NO NZ PA PE PH PL PT PY RO SE SG SI SK SV TR TW US UY&quot;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Godset fra Drammen&quot;</span><span class="p">,</span>
      <span class="nt">&quot;popularity&quot;</span><span class="p">:</span> <span class="s2">&quot;0.36&quot;</span><span class="p">,</span>
      <span class="nt">&quot;external-ids&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;isrc&quot;</span><span class="p">,</span>
          <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;NOFFM0897080&quot;</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;length&quot;</span><span class="p">:</span> <span class="mf">258.786</span><span class="p">,</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;spotify:track:67jdp9WXPR3ihTic9WXwmG&quot;</span><span class="p">,</span>
      <span class="nt">&quot;artists&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;spotify:artist:4AiqdizfguNQoWQ5N6Aaza&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;C-laget&quot;</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;track-number&quot;</span><span class="p">:</span> <span class="s2">&quot;8&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span></code></pre></div>



          </div>
          <nav class="span4">
            <strong>Android</strong>
            
<ul class="nav nav-pills nav-stacked">

  

  
    
  

  
    
      <li class=""><a href="/android101/pages/android-app-structure-and-components.html">App Structure and Components</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/view-layout.html">View Layout</a></li>
    
  
    
  


  

  
    
  

  
    
  
    
  
    
      <li class=""><a href="/android101/pages/common-view-controls.html">Common View Controls</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/list-list-adapters.html">Lists and List Adapters</a></li>
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>
            
            <strong>Network Communication</strong>
            
<ul class="nav nav-pills nav-stacked">

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/working-in-the-background.html">Working In the Background</a></li>
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/retrofit.html">Consume REST APIs with Retrofit</a></li>
    
  
    
  
    
  

  
</ul>

            <strong>Workshop</strong>
            
<ul class="nav nav-pills nav-stacked">

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/prerequisites.html">Prerequisites</a></li>
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
      <li class=""><a href="/android101/pages/assignments.html">Assignments</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
      <li class="active"><a href="/android101/pages/manuscript.html">Manuscript</a></li>
    
  
    
  
    
  
    
  
    
  

  
</ul>
          </nav>
        </div>
      </div>

    </body>
</html>
