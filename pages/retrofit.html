<!DOCTYPE html>
<html lang="nb">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Consume REST APIs with Retrofit</title>
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="/android101/css/syntax.css">
        <link href="/android101/css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link rel="stylesheet" href="/android101/css/main.css">
        <script src="/android101/js/jquery.min.js"></script>
        <script src="/android101/js/bootstrap.min.js"></script>

    </head>
    <body>
      <div class="container-fluid main">
        <div class="row-fluid">
          <div class="span8">
            <h1 class="page-header">Consume REST APIs with Retrofit</h1>
            Retrofit is a third-party library by Square for communicating with REST APIs over HTTP. Similarly to <code>AsyncTasks</code>, work is done in a background thread, and upon completion it returns the result to the main UI thread.

To use Retrofit, declare a service using a simple interface with annotated methods. Then, use the <code>Retrofit</code> class to create an object which can be used for REST calls. When Retrofit returns the result of the network call to the main UI thread, it can be parsed from JSON to Java domain objects by using a converter such as the <code>GsonConverter</code>. The use of this converter requires getters and setters with the same name as the JSON object keys.

As Retrofit handles the communication between the main UI thread and a background thread, in addition to JSON parsing when using a converter, it can greatly simply the workflow by reducing the amount of overhead.

<br/>

<p>Below is an example of the <code>MessageService.java</code> interface.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MessageService</span> <span class="o">{</span>
    <span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/messages&quot;</span><span class="o">)</span>
    <span class="n">Call</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;&gt;</span> <span class="nf">listMessages</span><span class="o">();</span>

    <span class="nd">@POST</span><span class="o">(</span><span class="s">&quot;/message&quot;</span><span class="o">)</span>
    <span class="n">Call</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="nf">send</span><span class="o">(</span><span class="nd">@Body</span> <span class="n">Message</span> <span class="n">message</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

The example below shows usage in an activity that displays the messages. Notice the Callback parameter that returns a success handler and a failure handler.
These will be run depending on the success of the request. Also, notice that we use the method <code>enqueue()</code>. This is to run our request asynchronously. If we wanted to run a synchronous request, <code>execute()</code> could be used instead.

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// Retrofit needs to know how to deserialize response, for instance into JSON</span>
<span class="n">Retrofit</span> <span class="n">retrofit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Retrofit</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">baseUrl</span><span class="o">(</span><span class="s">&quot;http://mobile-course.herokuapp.com&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">addConverterFactory</span><span class="o">(</span><span class="n">GsonConverterFactory</span><span class="o">.</span><span class="na">create</span><span class="o">())</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">MessageService</span> <span class="n">msgs</span> <span class="o">=</span> <span class="n">retrofit</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">MessageService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">msgs</span><span class="o">.</span><span class="na">listMessages</span><span class="o">().</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="n">Response</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="na">response</span><span class="o">.</span><span class="na">body</span><span class="o">();</span>
        <span class="c1">// Successfull request, do something with the retrieved messages</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Failed request. </span>
    <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

<h3>Gradle dependecy</h3>
This workshop is using the following dependencies for Retrofit and GSON converter:

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="n">compile</span> <span class="s1">&#39;com.squareup.retrofit2:retrofit:2.0.2&#39;</span>
<span class="n">compile</span> <span class="s1">&#39;com.squareup.retrofit2:converter-gson:2.0.2&#39;</span></code></pre></figure>




          </div>
          <nav class="span4">
            <strong>Android</strong>
            
<ul class="nav nav-pills nav-stacked">

  

  

  
    
      <li class=""><a href="/android101/pages/android-app-structure-and-components.html">App Structure and Components</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/view-layout.html">View Layout</a></li>
    
  
    
  


  

  

  
    
  
    
  
    
      <li class=""><a href="/android101/pages/common-view-controls.html">Common View Controls</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/list-recycler-view.html">Lists and RecyclerView</a></li>
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>
            
            <strong>Network Communication</strong>
            
<ul class="nav nav-pills nav-stacked">

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/working-in-the-background.html">Working In the Background</a></li>
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class="active"><a href="/android101/pages/retrofit.html">Consume REST APIs with Retrofit</a></li>
    
  
    
  
    
  

  
</ul>

            <strong>Workshop</strong>
            
<ul class="nav nav-pills nav-stacked">

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/prerequisites.html">Prerequisites</a></li>
    
  
    
  
    
  
    
  


  

  

  
    
  
    
      <li class=""><a href="/android101/pages/assignments.html">Assignments</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/manuscript.html">Manuscript</a></li>
    
  
    
  
    
  
    
  
    
  

  
</ul>
          </nav>
        </div>
      </div>

    </body>
</html>
